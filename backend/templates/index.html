
<html lang="es">
<head>
<meta charset="UTF-8">
<title>La Caza de Sombras üéÉ</title>
<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(180deg, #2c0f2c, #4b0f4b);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
}
h1 { color: #ff9900; text-shadow: 2px 2px 8px #000; }
#timer { font-size: 1.5em; margin: 10px; }
#puzzle { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; margin-top: 20px; }
.piece {
    width: 100px; height: 100px;
    background-color: #ff6600;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 2em;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.3s;
}
.piece:hover { transform: scale(1.1); box-shadow: 0 0 15px #ffcc66; }
#result { margin-top: 20px; font-size: 1.2em; }
button { padding: 10px 20px; font-size: 1em; margin-top: 10px; cursor: pointer; background:#ff9900; color:#000; border:none; border-radius:5px; }
#ranking { margin-top: 20px; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; }
#ranking h2 { margin: 0 0 10px 0; font-size: 1.2em; }
#ranking ol { padding-left: 20px; }
.particles {
    position: absolute;
    pointer-events: none;
    font-size: 1.5em;
    animation: rise 2s linear forwards;
}
@keyframes rise { 0% {opacity:1; transform:translateY(0px);} 100% {opacity:0; transform:translateY(-50px);}}
</style>
</head>
<body>

<h1>üéÉ La Caza de Sombras üéÉ</h1>
<div id="timer">Tiempo restante: <span id="time">60</span>s</div>

<div id="puzzle"></div>
<div id="result"></div>
<button id="restart">Reiniciar</button>

<div id="ranking">
<h2>üèÜ Ranking Top 5</h2>
<ol id="topList"></ol>
</div>

<script>
const piecesOrder = ['üéÉ','üëª','ü¶á','üï∏Ô∏è','üç¨','üßô‚Äç‚ôÄÔ∏è','üï∑Ô∏è','ü¶â','üíÄ'];
let pieces = [];
let time = 60;
let timerInterval;
let playerId = prompt("Ingresa tu Discord ID para registrar la puntuaci√≥n:");

function shuffle(array){ return array.sort(() => Math.random() - 0.5); }

function createPuzzle() {
    const puzzle = document.getElementById('puzzle');
    puzzle.innerHTML = '';
    pieces = shuffle([...piecesOrder]);
    pieces.forEach((icon, index)=>{
        const div = document.createElement('div');
        div.className = 'piece';
        div.textContent = icon;
        div.dataset.index = index;
        div.addEventListener('click', ()=>selectPiece(index, div));
        puzzle.appendChild(div);
    });
}

let firstSelected = null;
function selectPiece(index, element){
    if(firstSelected === null){
        firstSelected = index;
        element.style.transform='scale(1.2)';
    } else {
        [pieces[firstSelected], pieces[index]] = [pieces[index], pieces[firstSelected]];
        updatePuzzle();
        element.style.transform='';
        firstSelected = null;
        checkComplete();
        createParticles(element);
    }
}

function createParticles(element){
    const particle = document.createElement('div');
    particle.className='particles';
    particle.style.left=element.offsetLeft+'px';
    particle.style.top=element.offsetTop+'px';
    particle.textContent='‚ú®';
    document.body.appendChild(particle);
    setTimeout(()=>particle.remove(),2000);
}

function updatePuzzle(){
    const puzzle = document.getElementById('puzzle');
    puzzle.childNodes.forEach((div,i)=>div.textContent=pieces[i]);
}

function checkComplete(){
    for(let i=0;i<pieces.length;i++) if(pieces[i]!==piecesOrder[i]) return;
    endGame(true);
}

function startTimer(){
    timerInterval=setInterval(()=>{
        time--;
        document.getElementById('time').textContent=time;
        if(time<=0) endGame(false);
    },1000);
}

function endGame(win){
    clearInterval(timerInterval);
    document.getElementById('result').textContent=win?"¬°Felicidades! Completaste el puzzle üéâ":"Se acab√≥ el tiempo ‚è∞";
    sendScore(win?time:0);
}

function sendScore(score){
    fetch('http://localhost:5000/score',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({discord_id:playerId, score})
    }).then(res=>res.json()).then(data=>updateRanking());
}

function updateRanking(){
    fetch('http://localhost:5000/scores').then(res=>res.json()).then(data=>{
        const list = document.getElementById('topList');
        list.innerHTML='';
        data.forEach(item=>{
            const li=document.createElement('li');
            li.textContent=`${item.discord_id}: ${item.score}`;
            list.appendChild(li);
        });
    });
}

document.getElementById('restart').addEventListener('click',()=>{
    time=60;
    document.getElementById('time').textContent=time;
    createPuzzle();
    clearInterval(timerInterval);
    startTimer();
    document.getElementById('result').textContent='';
});

createPuzzle();
startTimer();
updateRanking();
</script>

</body>
</html>
